# vi:filetype=sh shiftwidth=2 softtabstop=2 tabstop=8:

# shellcheck shell=bash

# Use double quotes here because expressions inside single quotes won't expand
# Disable SC2016 (which warns about expressions in single quotes)
# shellcheck disable=SC2016

# This file contains key-bindings for bash commands so that I can be all kinds of lazy.
# Source this from your ~/.bashrc, like so:
#
#  [[ -s $HOME/.bash_bindings ]] && \. $HOME/.bash_bindings

builtin bind -m emacs '"\M-e": vi-editing-mode'
builtin bind -m vi-insert '"\M-e": emacs-editing-mode'
builtin bind -m vi-command '"\M-e": emacs-editing-mode'
builtin bind -m vi-insert 'Control-a: beginning-of-line'
builtin bind -m vi-insert 'Control-e: end-of-line'
builtin bind -m vi-insert 'Control-b: backward-char'
builtin bind -m vi-insert 'Control-f: forward-char'
builtin bind -m vi-insert '"\M-k": kill-line'
builtin bind -m vi-insert 'Control-l: clear-screen'
builtin bind -m vi-command '"Control-l": clear-screen'
builtin bind -m emacs '"Control-o": redraw-current-line'
builtin bind -m vi-insert '"\C-o": redraw-current-line'
builtin bind -m vi-command '"\C-o": redraw-current-line'
builtin bind -m vi-insert '"\M-o": magic-space'
builtin bind -m vi-command '"\M-o": magic-space'
builtin bind -m vi-insert '"\C-n": next-history'
builtin bind -m vi-command '"\C-n": next-history'
builtin bind -m vi-insert '"\C-p": previous-history'
builtin bind -m vi-command '"\C-p": previous-history'
builtin bind -m vi-insert 'Control-u: unix-line-discard'
builtin bind -m vi-command 'Control-u: unix-line-discard'
builtin bind -m vi-insert '"\M-m": menu-complete'
builtin bind -m vi-insert '"\M-w": unix-filename-rubout'
builtin bind -m vi-command '"\M-w": unix-filename-rubout'
builtin bind -m vi-insert '"\M-u": capitalize-word'
builtin bind -m vi-command '"\M-u": capitalize-word'
builtin bind -m vi-insert '"\C-d": delete-char'
builtin bind -m vi-command '"\C-d": delete-char'
builtin bind -m vi-insert '"\M-]": character-search'
builtin bind -m vi-insert '"\M-[": character-search-backward'

# Unbind Ctrl-w from werase in stty. See https://stackoverflow.com/questions/10980575/
stty werase undef
builtin bind -m emacs '"Control-w": unix-word-rubout'
builtin bind -m vi-insert '"\C-w": unix-word-rubout'
builtin bind -m vi-command '"\C-w": unix-word-rubout'

builtin bind '"\C-x0": kill-whole-line'     # Clears the entire line.
builtin bind '"\C-x1": magic-space'         # Performs history expansion and inserts a space.
builtin bind '"\C-x2": redraw-current-line' # Refreshes the current line.

# Tab completion of commands that cycles through possible options.
builtin bind -x '"\t": menu-complete'
builtin bind -m vi-insert '"\t": menu-complete'
builtin bind -m vi-command '"\t": menu-complete'

builtin bind -x '"\e[Z": menu-complete-backward'
builtin bind -m vi-insert '"\e[Z": menu-complete-backward'
builtin bind -m vi-command '"\e[Z": menu-complete-backward'

# Define a function to prepend 'sudo ' to the current command
sudo_insert() {
  READLINE_LINE="sudo $READLINE_LINE"
  READLINE_POINT=${#READLINE_LINE} # Move cursor to the end
}

# Insert 'sudo ' at the beginning of a command.
bind -x '"\C-s": sudo_insert'

# ls/eza
builtin bind -m vi-insert '"\M-l": "\C-x0eza -ahlrs date\r"'
builtin bind -m vi-command '"\M-l": "i\C-x0eza -ahlrs date\r"'
builtin bind -m vi-insert '"\M-L": "\C-x0eza -ahlrs date "'
builtin bind -m vi-command '"\M-L": "i\C-x0eza -ahlrs date "'

# List directories.
builtin bind -m vi-insert '"\M-i": "\C-x0eza -alD\r"'
builtin bind -m vi-command '"\M-i": "i\C-x0eza -alD\r"'
builtin bind -m vi-insert '"\M-I": "\C-x0eza -alD "'
builtin bind -m vi-command '"\M-I": "i\C-x1eza -alD "'

# List files sorted by time.
builtin bind -m vi-insert '"\C-xt": "\C-x0eza -hl --sort=age\r"'
builtin bind -m vi-insert '"\C-xt": "\C-x0eza -hl --sort=age\r"'
builtin bind -m vi-insert '"\C-xT": "\C-x0eza -ahl --sort=age "'
builtin bind -m vi-insert '"\C-xT": "i\C-x0eza -ahl --sort=age "'

# eza tree
builtin bind -m vi-insert '"\M-t": "\C-x0eza --tree\r"'
builtin bind -m vi-command '"\M-t": "i\C-x0eza --tree\r"'
builtin bind -m vi-insert '"\M-T": "\C-x0eza -lT "'
builtin bind -m vi-command '"\M-T": "i\C-x0eza -lT "'

# `eza tree` with detailed file info.
builtin bind -m vi-insert '"\C-xu": "\C-x0eza –-tree -–color=always –-header –-group –-links –-bytes –-long –-ignore-glob=.git\r"'
builtin bind -m vi-command '"\C-xu": "i\C-x0eza –-tree -–color=always –-header –-group –-links –-bytes –-long –-ignore-glob=.git\r"'
builtin bind -m vi-insert '"\C-x\C-u": "\C-x0eza -lThgB --color=always -I .git "'
builtin bind -m vi-command '"\C-x\C-u": "i\C-x0eza -lThgB --color=always -I .git "'

# Ping Google's DNS server.
builtin bind -m vi-insert '"\C-xp": "\C-x0ping -c 3 8.8.8.8\r"'
builtin bind -m vi-command '"\C-xp": "i\C-x0ping -c 3 8.8.8.8\r"'
builtin bind -m vi-insert '"\C-xP": "\C-x0ping -c 3 8.8.8.8 "'
builtin bind -m vi-command '"\C-xP": "i\C-x0ping -c 3 8.8.8.8 "'

# Source ~/.bashrc
builtin bind -m vi-insert '"\C-x\C-s": "\C-x0source ~/.bashrc\r"'
builtin bind -m vi-command '"\C-x\C-s": "i\C-x0source ~/.bashrc\r"'

# Go-to bindings:
builtin bind -m vi-insert '"\M-dc": "\C-x0cd ~/.config\r"'
builtin bind -m vi-command '"\M-dc": "i\C-x0cd ~/.config\r"'

builtin bind -m vi-insert '"\M-dd": "\C-x0cd ~/Documents\r"'
builtin bind -m vi-command '"\M-dd": "i\C-x0cd ~/Documents\r"'

builtin bind -m vi-insert '"\M-dD": "\C-x0cd ~/Downloads\r"'
builtin bind -m vi-command '"\M-dD": "i\C-x0cd ~/Downloads\r"'

builtin bind -m vi-insert '"\M-dn": "\C-x0cd ~/.config/nvim\r"'
builtin bind -m vi-command '"\M-dn": "i\C-x0cd ~/.config/nvim\r"'

builtin bind -m vi-insert '"\M-ds": "\C-x0cd ~/Pictures/screenshots\r"'
builtin bind -m vi-command '"\M-ds": "i\C-x0cd ~/Pictures/screenshots\r"'

builtin bind -m vi-insert '"\M-dp": "\C-x0cd ~/workspaces/webdavis/projects\r"'
builtin bind -m vi-command '"\M-dp": "i\C-x0cd ~/workspaces/webdavis/projects\r"'

builtin bind -m vi-insert '"\M-dt": "\C-x0cd ~/workspaces/tools\r"'
builtin bind -m vi-command '"\M-dt": "i\C-x0cd ~/workspaces/tools\r"'

builtin bind -m vi-insert '"\M-dT": "\C-x0cd ~/workspaces/test\r"'
builtin bind -m vi-command '"\M-dT": "i\C-x0cd ~/workspaces/test\r"'

# Go-to a projects root directory. The respective keyboard binding is in ~/.inputrc.
__go_to_project_root() {
  local path
  path="$(pwd)"

  # Add VCS root indicators (or project markers) to the 'markers' array.
  local markers=(.git .hg .svn .bzr .build.xml .project .projections.json .root .tasks)

  while :; do
    local marker
    for marker in "${markers[@]}"; do
      if [[ -e "${path}/${marker}" || -d "${path}/${marker}" ]]; then
        builtin cd "$path" || return 1
        pwd
        return 0
      fi
    done

    if [[ $path == "/" ]]; then
      local yellow reset
      yellow="$(tput setaf 3)"
      reset="$(tput sgr0)"
      printf "${yellow}Warning[%s]: No project root found.${reset}\n" "${FUNCNAME[0]}" >&2
      return 1
    fi
    path="$(dirname "$path")"
  done
}
builtin bind -m vi-insert '"\C-gdr": "\C-x0__go_to_project_root\r"'
builtin bind -m vi-command '"\C-gdr": "i\C-x0__go_to_project_root\r"'

# git --version
builtin bind -m vi-insert '"\C-gv": "\C-x0git --version\r"'
builtin bind -m vi-command '"\C-gv": "i\C-x0git --version\r"'

# git status
builtin bind -m vi-insert '"\C-gs": "\C-x0git status\r"'
builtin bind -m vi-command '"\C-gs": "i\C-x0git status\r"'

# git log
builtin bind -m vi-insert '"\C-gll": "\C-x0git log\r"'
builtin bind -m vi-command '"\C-gll": "i\C-x0git log\r"'

# git log --oneline
builtin bind -m vi-insert '"\C-glo": "\C-x0git log --oneline\r"'
builtin bind -m vi-command '"\C-glo": "i\C-x0git log --oneline\r"'

# Print the current git working diff.
builtin bind -m vi-insert '"\C-gdd": "\C-x0git diff\r"'
builtin bind -m vi-command '"\C-gdd": "i\C-x0git diff\r"'

# Print the current git diff of the latest commit.
builtin bind -m vi-insert '"\C-gdl": "\C-x0git diff HEAD^\r"'
builtin bind -m vi-command '"\C-gdl": "i\C-x0git diff HEAD^\r"'

# Print the diff of the current and previous commit.
builtin bind -m vi-insert '"\C-gdp": "\C-x0git diff-index --quiet HEAD -- || clear; git --no-pager diff --patch-with-stat\r"'
builtin bind -m vi-command '"\C-gdp": "i\C-x0git diff-index --quiet HEAD -- || clear; git --no-pager diff --patch-with-stat\r"'

# git diff --cached
builtin bind -m vi-insert '"\C-gdc": "\C-x0git diff --cached\r"'
builtin bind -m vi-command '"\C-gdc": "i\C-x0git diff --cached\r"'

# `git checkout `
builtin bind -m vi-insert '"\C-gkk": "\C-x0git checkout "'
builtin bind -m vi-command '"\C-gkk": "i\C-x0git checkout "'

# `git checkout -b `
builtin bind -m vi-insert '"\C-gkn": "\C-x0git checkout -b "'
builtin bind -m vi-command '"\C-gkn": "i\C-x0git checkout -b "'

# git checkout -
builtin bind -m vi-insert '"\C-gk-": "\C-x0git checkout -\r"'
builtin bind -m vi-command '"\C-gk-": "i\C-x0git checkout -\r"'

# git checkout main
builtin bind -m vi-insert '"\C-gkm": "\C-x0git checkout main\r"'
builtin bind -m vi-command '"\C-gkm": "i\C-x0git checkout main\r"'

# Switch to an existing remote branch:
# git checkout --track <remote_name/branch_name>
builtin bind -m vi-insert '"\C-gkt": "\C-x0git checkout --track "'
builtin bind -m vi-command '"\C-gkt": "i\C-x0git checkout --track "'

# git commit --verbose
builtin bind -m vi-insert '"\C-gcc": "\C-x0git commit --verbose\r"'
builtin bind -m vi-command '"\C-gcc": "i\C-x0git commit --verbose\r"'

# git commit --verbose -m '<cursor>'
builtin bind -m vi-insert "\"\C-gcm\": \"\C-x0git commit --verbose -m ''\e[D\""
builtin bind -m vi-command "\"\C-gcm\": \"i\C-x0git commit --verbose -m ''\e[D\""

# git commit --verbose --amend
builtin bind -m vi-insert '"\C-gca": "\C-x0git commit --verbose --amend\r"'
builtin bind -m vi-command '"\C-gca": "i\C-x0git commit --verbose --amend\r"'

# git commit --verbose --all
builtin bind -m vi-insert '"\C-gcA": "\C-x0git commit --verbose --all\r"'
builtin bind -m vi-command '"\C-gcA": "i\C-x0git commit --verbose --all\r"'

# git commit --amend --no-edit
builtin bind -m vi-insert '"\C-gcn": "\C-x0git commit --amend --no-edit\r"'
builtin bind -m vi-command '"\C-gcn": "i\C-x0git commit --amend --no-edit\r"'

# git commit --amend --no-edit --all
builtin bind -m vi-insert '"\C-gcN": "\C-x0git commit --amend --no-edit --all\r"'
builtin bind -m vi-command '"\C-gcN": "i\C-x0git commit --amend --no-edit --all\r"'

# git reset
builtin bind -m vi-insert '"\C-gru": "\C-x0git reset        # Unstage changes, keep working directory unchanged"'
builtin bind -m vi-command '"\C-gru": "i\C-x0git reset        # Unstage changes, keep working directory unchanged"'

# git reset --soft HEAD~1
builtin bind -m vi-insert '"\C-grs": "\C-x0git reset --soft HEAD~1        # Undo last commit, keep changes staged for new commit"'
builtin bind -m vi-command '"\C-grs": "i\C-x0git reset --soft HEAD~1        # Undo last commit, keep changes staged for new commit"'

# git reset --hard (discards all changes in working and staging)
builtin bind -m vi-insert '"\C-grh": "\C-x0git reset --hard        # Reset HEAD, index, and working files, discarding all changes"'
builtin bind -m vi-command '"\C-grh": "i\C-x0git reset --hard        ## Reset HEAD, index, and working files, discarding all changes"'

# git restore
builtin bind -m vi-insert '"\C-grr": "\C-x0git restore        # Discard all uncommitted changes in the working directory"'
builtin bind -m vi-command '"\C-grr": "i\C-x0git restore        # Discard all uncommitted changes in the working directory"'

# git restore <file>
builtin bind -m vi-insert '"\C-grf": "\C-x0git restore -- <file>"'
builtin bind -m vi-command '"\C-grf": "i\C-x0git restore -- <file>"'

# git init
builtin bind -m vi-insert '"\C-gii": "\C-x0git init\r"'
builtin bind -m vi-command '"\C-gii": "i\C-xgit init\r"'

# git init && gh repo create
builtin bind -m vi-insert '"\C-gic": "\C-x0git rev-parse --is-inside-work-tree &>/dev/null || git init; gh repo create\r"'
builtin bind -m vi-command '"\C-gic": "i\C-x0git rev-parse --is-inside-work-tree &>/dev/null || git init; gh repo create\r"'

# git push
builtin bind -m vi-insert '"\C-gpp": "\C-x0git push\r"'
builtin bind -m vi-command '"\C-gpp": "i\C-x0git push\r"'

# git push --force
builtin bind -m vi-insert '"\C-gpf": "\C-x0git push --force\r"'
builtin bind -m vi-command '"\C-gpf": "i\C-x0git push --force\r"'

# Delete remote_branch branch from the origin remote.
# `git push origin :remote_branch`
builtin bind -m vi-insert '"\C-gpr": "\C-x0git push origin :"'
builtin bind -m vi-command '"\C-gpr": "i\C-x0git push origin :"'

__bash_bindings_helper_get_open_cmd() {
  command -v open 2>/dev/null && return 0
  command -v xdg-open 2>/dev/null && return 0

  printf "Error [%s]: Cannot determine open command for operating sysem: %s\n" \
    "${FUNCNAME[*]}" \
    "$OSTYPE" \
    >&2
  return 1
}

__bash_bindings_open_github_page() {
  local url_suffix="${1:-}"
  local page_desc="${2:-$1}"
  page_desc="${page_desc^}"

  local repo json_field jq_filter
  local url="https://github.com"

  case "$url_suffix" in
    "feed") ;;
    "profile") json_field="owner" jq_filter="owner.login" url_suffix="" ;;
    *) json_field="nameWithOwner" jq_filter="nameWithOwner" ;;
  esac

  local IFS=":"
  if [[ -n $json_field ]]; then
    repo="$(gh repo view --json ${json_field} --jq ."${jq_filter}" 2>/dev/null)" || {
      printf "Error [%s]: Could not determine GitHub repository. Are you in a git repo with a GitHub remote?\n" "${FUNCNAME[0]}" >&2
      return 1
    }

    url="${url}/${repo}/${url_suffix}"
  fi

  local open_cmd
  open_cmd="$(__bash_bindings_helper_get_open_cmd)" || return 1

  printf "Opening GitHub%s page%s in browser.\n" "${page_desc:+ $page_desc}" "${repo:+ for $repo}"
  "$open_cmd" "$url"
}

# Open GitHub Feed (https://github.com) in browser.
builtin bind -x '"\C-_I": "__bash_bindings_open_github_page '\''feed'\''"'
builtin bind -m vi-insert '"\C-gof": "\C-x0\C-_I\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-gof": "i\C-x0\C-_I\C-x1\C-x2\b"'

# Open repo's GitHub Home page in browser.
builtin bind -x '"\C-_J": "__bash_bindings_open_github_page '\'''\'' '\''Home'\''"'
builtin bind -m vi-insert '"\C-goo": "\C-x0\C-_J\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goo": "i\C-x0\C-_J\C-x1\C-x2\b"'

# Open repo's GitHub Issues page in browser.
builtin bind -x '"\C-_K": "__bash_bindings_open_github_page '\''issues'\''"'
builtin bind -m vi-insert '"\C-goi": "\C-x0\C-_K\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goi": "i\C-x0\C-_K\C-x1\C-x2\b"'

# Open repo's GitHub Pull Requests page in browser.
builtin bind -x '"\C-_R": "__bash_bindings_open_github_page '\''pulls'\'' '\''Pull Requests'\''"'
builtin bind -m vi-insert '"\C-gop": "\C-x0\C-_R\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-gop": "i\C-x0\C-_R\C-x1\C-x2\b"'

# Open repo's GitHub Actions page in browser.
builtin bind -x '"\C-_S": "__bash_bindings_open_github_page '\''actions'\''"'
builtin bind -m vi-insert '"\C-goa": "\C-x0\C-_S\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goa": "i\C-x0\C-_S\C-x1\C-x2\b"'

# Open repo's GitHub Projects page in browser.
builtin bind -x '"\C-_T": "__bash_bindings_open_github_page '\''projects'\''"'
builtin bind -m vi-insert '"\C-goP": "\C-x0\C-_T\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goP": "i\C-x0\C-_T\C-x1\C-x2\b"'

# Open repo's GitHub Wiki page in browser.
builtin bind -x '"\C-_U": "__bash_bindings_open_github_page '\''wiki'\''"'
builtin bind -m vi-insert '"\C-gow": "\C-x0\C-_U\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-gow": "i\C-x0\C-_U\C-x1\C-x2\b"'

# Open repo's GitHub Security page in browser.
builtin bind -x '"\C-_V": "__bash_bindings_open_github_page '\''security'\''"'
builtin bind -m vi-insert '"\C-goS": "\C-x0\C-_V\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goS": "i\C-x0\C-_V\C-x1\C-x2\b"'

# Open repo's GitHub Insights page in browser.
builtin bind -x '"\C-_W": "__bash_bindings_open_github_page '\''pulse'\'' '\''Insights'\''"'
builtin bind -m vi-insert '"\C-goI": "\C-x0\C-_W\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-goI": "i\C-x0\C-_W\C-x1\C-x2\b"'

# Open repo's GitHub Settings page in browser.
builtin bind -x '"\C-_X": "__bash_bindings_open_github_page '\''settings'\''"'
builtin bind -m vi-insert '"\C-gos": "\C-x0\C-_X\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-gos": "i\C-x0\C-_X\C-x1\C-x2\b"'

# Open My GitHub Profile in browser.
builtin bind -x '"\C-_Y": "__bash_bindings_open_github_page '\''profile'\''"'
builtin bind -m vi-insert '"\C-go.": "\C-x0\C-_Y\C-x1\C-x2\b"'
builtin bind -m vi-command '"\C-go.": "i\C-x0\C-_Y\C-x1\C-x2\b"'

__git_list_tags() {
  git tag --list --sort='v:refname'
}

# git tag --list --sort=v:refname
builtin bind -m vi-insert '"\C-gtl": "\C-x0__git_list_tags\r"'
builtin bind -m vi-command '"\C-gtl": "i\C-x0__git_list_tags\r"'

# `git add `
builtin bind -m vi-insert '"\C-gaa": "\C-x0git add "'
builtin bind -m vi-command '"\C-gaa": "i\C-x0git add "'

# git add --update
builtin bind -m vi-insert '"\C-gau": "\C-x0git add --update\r"'
builtin bind -m vi-command '"\C-gau": "i\C-x0git add --update\r"'

# git add .
builtin bind -m vi-insert '"\C-ga.": "\C-x0git add .\r"'
builtin bind -m vi-command '"\C-ga.": "i\C-x0git add .\r"'

# `git branch `
builtin bind -m vi-insert '"\C-gbb": "\C-x0git branch "'
builtin bind -m vi-command '"\C-gbb": "i\C-x0git branch "'

# git branch -vv
builtin bind -m vi-insert '"\C-gbv": "\C-x0git branch -vv\r"'
builtin bind -m vi-command '"\C-gbv": "i\C-x0git branch -vv\r"'

# git branch -m
builtin bind -m vi-insert '"\C-gbm": "\C-x0git branch -m "'
builtin bind -m vi-command '"\C-gbm": "i\C-x0git branch -m "'

# gh issue list
builtin bind -m vi-insert '"\C-ghi": "\C-x0gh issue list\r"'
builtin bind -m vi-command '"\C-ghi": "i\C-x0gh issue list\r"'

# gh pr list
builtin bind -m vi-insert '"\C-ghp": "\C-x0gh pr list\r"'
builtin bind -m vi-command '"\C-ghp": "i\C-x0gh pr list\r"'

# nvm use default
builtin bind -m vi-insert '"\C-xnu": "\C-x0nvm use default\r"'
builtin bind -m vi-command '"\C-xnu": "i\C-x0nvm use default\r"'

# Package manager update
__update_package_manager() {
  local os distro command
  case "$OSTYPE" in
    solaris*) os='solaris' ;;
    darwin*)
      os='osx'
      command -v brew &>/dev/null || return
      ;;
    linux*) os='linux' ;;
    bsd*) os='bsd' ;;
    msys*) os='windows' ;;
    *)
      printf "Warning [%s]: Cannot update. Unknown operating system detected: '%s'\n." \
        "${FUNCNAME[0]}" "${OSTYPE}" >&2
      return 1
      ;;
  esac

  case "${os}" in
    'linux')
      if [[ -f '/etc/os-release' ]]; then
        distro="$(grep '^NAME=' /etc/os-release | sed -e's/NAME="\(.*\)"/\1/g')"
      fi
      ;;
    'osx')
      distro="osx"
      ;;
    *)
      printf '%s\n' "Cannot update. Unknown distro detected." 1>&2
      return 1
      ;;
  esac

  case "${distro}" in
    'osx')
      command='brew upgrade'
      ;;
    'Arch Linux')
      command='sudo pacman --noconfirm --sync --refresh --sysupgrade'
      ;;
    'Ubuntu')
      command='sudo apt update && sudo apt upgrade --yes'
      ;;
  esac
  $command
}
builtin bind -m vi-insert '"\C-xou": "\C-x0__update_package_manager\r"'
builtin bind -m vi-command '"\C-xou": "i\C-x0__update_package_manager\r"'

# `brew search `
builtin bind -m vi-insert '"\C-xos": "\C-x0brew search "'
builtin bind -m vi-command '"\C-xos": "i\C-x0brew search "'

# `brew install `
builtin bind -m vi-insert '"\C-xoi": "\C-x0brew install "'
builtin bind -m vi-command '"\C-xoi": "i\C-x0brew install "'

# Function to redraw the prompt
redraw_prompt() {
  tput rc # Restore cursor position
  tput ed # Clear to end of screen
  tput sc # Save cursor position
}

# `cd -`
builtin bind -m vi-insert '"\C-x-": "\C-x0cd -\r"'
builtin bind -m vi-command '"\C-x-": "i\C-x0cd -\r"'

# List git files with last modified:
__git_ls_files_with_last_modified() {
  # Header:
  printf "\n%-25s %-7s %s\n" "Last Modified" "Commit" "File"
  printf "%-25s %-10s %s\n" "—————————————————————————" "———————" "———————————————————————— "

  # ANSI color codes:
  local blue='\033[34m'
  local yellow='\033[33m'
  local reset='\033[0m'

  local file last_commit_info date commit_hash

  # Capture files with git metadata:
  local -a files=()
  while read -r file; do
    last_commit_info=$(git log -1 --format="%ci|%h" -- "$file")
    date="${last_commit_info%%|*}"
    commit_hash="${last_commit_info##*|}"
    files+=("${date}|${commit_hash}|${file}")
  done < <(git ls-files)

  # Sort files:
  local -a sorted
  mapfile -t sorted < <(printf "%s\n" "${files[@]}" | sort -r)

  # Print sorted files:
  for line in "${sorted[@]}"; do
    IFS="|" read -r date commit_hash file <<<"$line"
    printf "%b%-25s%b %b%-6s%b %s\n" \
      "$blue" "$date" "$reset" \
      "$yellow" "$commit_hash" "$reset" \
      "$file"
  done
}

builtin bind -m vi-insert '"\C-xl": "\C-x0__git_ls_files_with_last_modified\r"'
builtin bind -m vi-command '"\C-xl": "i\C-x0__git_ls_files_with_last_modified\r"'
